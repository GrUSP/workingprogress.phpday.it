extends includes/layout.pug

block content
  - contact_url = "mailto:" + site.data.defaults.conference.contact_email
  section(id="schedule")
    include includes/_breadcrumbs.pug

    //- we count the number of tracks in order to know if the table must have more than one column
    - no_tracks = 0
    each track in site.data.talks_speakers.tracks
      - no_tracks++

    .container
      .inner
        //- we count the days - useful for the page layout
        - var no_days = 0
        each day in site.data.talks_speakers.days
          - no_days++
        //- if there is only one day, the title must be aligned to the left
        - title_classes = ""
        if(no_days > 1)
          - title_classes += "is-centered"
        else
          - title_classes += "has-text-left"
        .title-container.title-container_schedule
          h1(class=title_classes role="heading" aria-level="1").title-is-1 !{page.title}
        //- links to every day in page if there is more than 1 day
        if(no_days > 1)
          .container.date-menu
            .inner
              each day in site.data.talks_speakers.days
                - anchor = `#${day.title}`
                a(role="button" href=anchor).button.is-rounded.is-primary.is-medium !{day.title}
        each day in site.data.talks_speakers.days

          - the_id = day.title
          .timeline
            .info-bar
              .row-info
                .info-icon.padded
                  include ../source/assets/ico/ico-calendar.svg
                  - start_date = date(day.date, config.date_format_hero)
                .info__date(id=the_id)
                  time(datetime=day_date) !{start_date}
            table.table.is-fullwidth.is-hoverable
              tbody
                - colcount = 0
                //- we transform the talks into an array
                - const items = []
                each talk, key in day.talks
                  - items.push(talk)
                //- order the array by ntrack and time
                - items.sort((a, b) => (a.track > b.track) ? 1 : -1).sort((a, b) => (a.start_datetime > b.start_datetime) ? 1 : -1)
                each item, key in items
                  - tr_classes = ""
                  - td_classes = ""
                  if(item.item_type !== 'service')
                    - tr_classes += "has-background "
                  if(item.service_icon)
                    - td_classes += "has-service-icon "
                  if(item.item_type == 'service')
                    tr(class=tr_classes)
                      td(class=td_classes colspan=no_tracks)
                        time(datetime=item.start_datetime) !{time(item.start_datetime, config.time_format_schedule)} - !{time(item.end_datetime, config.time_format_schedule)}
                        br
                        strong !{item.talk_title}
                        if(item.service_icon)
                          if(item.service_icon == "coffee")
                            include ../source/assets/ico/ico-coffee.svg
                          if(item.service_icon == "cutlery")
                            include ../source/assets/ico/ico-cutlery.svg
                          if(item.service_icon == "glass")
                            include ../source/assets/ico/ico-glass.svg
                        br
                        if(item.host_name)
                          span !{item.host_name}
                  else if(item.item_type == 'keynote')
                    tr(class=tr_classes)
                      td(class=td_classes colspan=no_tracks)
                        time(datetime=item.start_datetime) !{time(item.start_datetime, config.time_format_schedule)} - !{time(item.end_datetime, config.time_format_schedule)}
                        br
                        strong Keynote
                          if(item.item)
                            | :&nbsp!{item.talk_title}
                        br
                        if(item.host_name)
                          span !{item.host_name}
                        if(item.speakers)
                          each speaker in item.speakers
                            span !{speaker.speaker_name}
                            if(speaker.speaker_role)
                              span !{speaker.speaker_role}
                        if(item.talk_description)
                          br
                          | !{item.talk_description}
                  else
                    if(colcount == no_tracks)
                      tr(class=tr_classes)
                      - colcount = 0
                    if(item.item_type == 'talk')
                      - colcount++
                      td(style=`width: calc(100% / ${no_tracks})`).has-background
                        time(datetime=item.start_datetime) !{time(item.start_datetime, config.time_format_schedule)} - !{time(item.end_datetime, config.time_format_schedule)}
                        br
                        if(item.track)
                          span.track-title !{item.track.title}
                        br
                        - talk_url = url_for("talks_speakers") + "#" + key
                        strong(id=key).talk-anchor
                          a(href=talk_url) !{item.talk_title}
                        br
                        if(item.host_name)
                          span !{item.host_name}
                        if(item.speakers)
                          each speaker in item.speakers
                            span !{speaker.speaker_name}
                    else if(item.item_type == 'workshop')
                      - colcount++
                      td(style=`width: calc(100% / ${no_tracks})`).has-background
                        time(datetime=item.start_datetime) !{time(item.start_datetime, config.time_format_schedule)} - !{time(item.end_datetime, config.time_format_schedule)}
                        br
                        strong Workshop
                          if(item.talk_title)
                            | :&nbsp!{item.talk_title}
                        br
                        if(item.host_name)
                          span !{item.host_name}
                        if(item.speakers)
                          each speaker in item.speakers
                            span !{speaker.speaker_name}
                            if(speaker.speaker_role)
                              span !{speaker.speaker_role}
                        if(item.talk_description)
                          br
                          | !{item.talk_description}
                    else if(item.item_type == 'other')
                      - colcount++
                      td(style=`width: calc(100% / ${no_tracks})`).has-background
                        time(datetime=item.start_datetime) !{time(item.start_datetime, config.time_format_schedule)} - !{time(item.end_datetime, config.time_format_schedule)}
                        br
                        if(item.talk_title)
                          strong !{item.talk_title}
                        if(item.talk_description)
                          br
                          | !{item.talk_description}

    //- imported components
    include components/newsletter/newsletter
    if(site.data.defaults.conference.sponsors_visible)
      include components/sponsors/sponsors
    if site.data.defaults.conference.community_partners
      include components/community_partners/community_partners